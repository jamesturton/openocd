#
# NXP (Freescale) MPC5748G - dual-core Power Architecture
#

reset_config srst_only

if { [info exists CHIPNAME] } {
	set _CHIPNAME $CHIPNAME
} else {
	set _CHIPNAME mpc5748g
}

if { [info exists CPUTAPID] } {
	set _CPUTAPID $CPUTAPID
} else {
	set _CPUTAPID 0x0988101d
	set _ONCEID 0x07c5201d
}

set _ENDIAN big

jtag newtap $_CHIPNAME cpu -irlen 6 -expected-id $_CPUTAPID -expected-id $_ONCEID

set _TARGETNAME $_CHIPNAME.cpu
# dap create $_CHIPNAME.dap -chain-position $_CHIPNAME.cpu
target create ${_TARGETNAME}0 mpc57xx -endian $_ENDIAN -chain-position $_TARGETNAME
#target create ${_TARGETNAME}1 mpc57xx

${_TARGETNAME}0 configure -work-area-phys 0x40000000 -work-area-size 0xC0000

set _FLASHNAME $_CHIPNAME.flash
set _FLASHSIZE 0x005F0000
set _FLASHBASE 0x00F90000
flash bank $_CHIPNAME.flash mpc57xx $_FLASHBASE $_FLASHSIZE 1 32 ${_TARGETNAME}0

# target smp ${_TARGETNAME}0 ${_TARGETNAME}1
